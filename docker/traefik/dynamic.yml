# ===========================================
# Traefik Dynamic Configuration
# ===========================================
# Middleware and static routes
# ===========================================

http:
  # Middlewares
  middlewares:
    # Security headers for all routes
    security-headers:
      headers:
        frameDeny: true
        contentTypeNosniff: true
        browserXssFilter: true
        referrerPolicy: "strict-origin-when-cross-origin"
        customResponseHeaders:
          X-Powered-By: ""
    
    # Rate limiting
    rate-limit:
      rateLimit:
        average: 100
        burst: 50
    
    # CORS for API
    cors:
      headers:
        accessControlAllowMethods:
          - GET
          - POST
          - PUT
          - DELETE
          - OPTIONS
        accessControlAllowHeaders:
          - Content-Type
          - Authorization
        accessControlAllowOriginList:
          - "*"
        accessControlMaxAge: 100
        addVaryHeader: true

  # Routers for PaaS platform
  routers:
    # Frontend dashboard
    frontend:
      rule: "Host(`laravel-paas.horn-yastudio.com`) || Host(`www.laravel-paas.horn-yastudio.com`)"
      service: frontend
      entryPoints:
        - web
      middlewares:
        - security-headers
    
    # Backend API
    api:
      rule: "Host(`laravel-paas.horn-yastudio.com`) && PathPrefix(`/api`)"
      service: backend
      entryPoints:
        - web
      middlewares:
        - cors
        - security-headers
        - rate-limit

  # Services
  services:
    frontend:
      loadBalancer:
        servers:
          - url: "http://paas-frontend:80"
    
    backend:
      loadBalancer:
        servers:
          - url: "http://paas-backend:8080"
